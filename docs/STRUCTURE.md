# é¡¹ç›®ç›®å½•ç»“æ„è¯´æ˜

## ğŸ“ å®Œæ•´ç›®å½•æ ‘

```
wallet/
â”œâ”€â”€ cmd/                          # å¯æ‰§è¡Œç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ server/                   # API æœåŠ¡å™¨
â”‚   â”‚   â””â”€â”€ main.go              # HTTP API æœåŠ¡
â”‚   â”œâ”€â”€ worker/                   # åå°ä»»åŠ¡
â”‚   â”‚   â””â”€â”€ main.go              # æ‰«å—ã€å½’é›†ç­‰åå°ä»»åŠ¡
â”‚   â””â”€â”€ cli/                      # å‘½ä»¤è¡Œå·¥å…·
â”‚       â””â”€â”€ main.go              # Gas ä¼°ç®—ç­‰ CLI å·¥å…·
â”‚
â”œâ”€â”€ internal/                     # ç§æœ‰åº”ç”¨ä»£ç ï¼ˆä¸å¯¹å¤–æš´éœ²ï¼‰
â”‚   â”œâ”€â”€ scanner/                  # æ‰«å—æ¨¡å— âœ… å·²å®ç°
â”‚   â”‚   â”œâ”€â”€ scanner.go           # æ‰«å—æ ¸å¿ƒé€»è¾‘
â”‚   â”‚   â””â”€â”€ deposit_handler.go   # å……å€¼å¤„ç†å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ transfer/                 # è½¬è´¦æ¨¡å— âœ… å·²å®ç°
â”‚   â”‚   â””â”€â”€ transfer.go          # è½¬è´¦é€»è¾‘
â”‚   â”‚
â”‚   â”œâ”€â”€ risk/                     # é£æ§æ¨¡å— âœ… å·²å®ç°
â”‚   â”‚   â””â”€â”€ checker.go           # é£æ§æ£€æŸ¥å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ collect/                  # å½’é›†æ¨¡å— ğŸš§ å¾…å®ç°
â”‚   â”‚   â”œâ”€â”€ collector.go         # å½’é›†ç­–ç•¥
â”‚   â”‚   â”œâ”€â”€ scheduler.go         # å®šæ—¶è°ƒåº¦
â”‚   â”‚   â””â”€â”€ rules.go             # å½’é›†è§„åˆ™
â”‚   â”‚
â”‚   â”œâ”€â”€ deposit/                  # å…¥è´¦æ¨¡å— ğŸš§ å¾…å®ç°
â”‚   â”‚   â”œâ”€â”€ detector.go          # å……å€¼æ£€æµ‹
â”‚   â”‚   â”œâ”€â”€ confirm.go           # ç¡®è®¤æœºåˆ¶
â”‚   â”‚   â””â”€â”€ notify.go            # å…¥è´¦é€šçŸ¥
â”‚   â”‚
â”‚   â”œâ”€â”€ wallet/                   # é’±åŒ…ç®¡ç† ğŸš§ å¾…å®ç°
â”‚   â”‚   â”œâ”€â”€ manager.go           # é’±åŒ…ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ keystore.go          # å¯†é’¥å­˜å‚¨
â”‚   â”‚   â””â”€â”€ address.go           # åœ°å€ç”Ÿæˆ
â”‚   â”‚
â”‚   â”œâ”€â”€ repository/               # æ•°æ®è®¿é—®å±‚ ğŸš§ å¾…å®ç°
â”‚   â”‚   â”œâ”€â”€ transaction.go       # äº¤æ˜“è®°å½•
â”‚   â”‚   â”œâ”€â”€ address.go           # åœ°å€ç®¡ç†
â”‚   â”‚   â””â”€â”€ balance.go           # ä½™é¢ç®¡ç†
â”‚   â”‚
â”‚   â””â”€â”€ service/                  # ä¸šåŠ¡æœåŠ¡å±‚ ğŸš§ å¾…å®ç°
â”‚       â”œâ”€â”€ wallet_service.go
â”‚       â”œâ”€â”€ transaction_service.go
â”‚       â””â”€â”€ chain_service.go
â”‚
â”œâ”€â”€ pkg/                          # å…¬å…±åº“ï¼ˆå¯å¤ç”¨ã€å¯å¯¼å‡ºï¼‰
â”‚   â”œâ”€â”€ gas/                      # Gas ä¼°ç®— âœ… å·²å®ç°
â”‚   â”‚   â”œâ”€â”€ suggest.go           # Gas å‚æ•°ä¼°ç®—
â”‚   â”‚   â””â”€â”€ example_test.go      # ä½¿ç”¨ç¤ºä¾‹
â”‚   â”‚
â”‚   â”œâ”€â”€ chain/                    # é“¾å®¢æˆ·ç«¯å°è£… ğŸš§ å¾…å®ç°
â”‚   â”‚   â”œâ”€â”€ client.go            # ç»Ÿä¸€å®¢æˆ·ç«¯æ¥å£
â”‚   â”‚   â”œâ”€â”€ ethereum.go          # ä»¥å¤ªåŠå®ç°
â”‚   â”‚   â”œâ”€â”€ bsc.go               # BSC å®ç°
â”‚   â”‚   â””â”€â”€ polygon.go           # Polygon å®ç°
â”‚   â”‚
â”‚   â”œâ”€â”€ signer/                   # ç­¾åå·¥å…· ğŸš§ å¾…å®ç°
â”‚   â”‚   â”œâ”€â”€ signer.go
â”‚   â”‚   â””â”€â”€ local.go             # æœ¬åœ°ç­¾å
â”‚   â”‚
â”‚   â”œâ”€â”€ crypto/                   # åŠ å¯†å·¥å…· ğŸš§ å¾…å®ç°
â”‚   â”‚   â”œâ”€â”€ aes.go
â”‚   â”‚   â””â”€â”€ kms.go               # KMS é›†æˆ
â”‚   â”‚
â”‚   â””â”€â”€ utils/                    # é€šç”¨å·¥å…· ğŸš§ å¾…å®ç°
â”‚       â”œâ”€â”€ bigint.go            # å¤§æ•°å¤„ç†
â”‚       â”œâ”€â”€ retry.go             # é‡è¯•é€»è¾‘
â”‚       â””â”€â”€ logger.go            # æ—¥å¿—å·¥å…·
â”‚
â”œâ”€â”€ api/                          # API å®šä¹‰
â”‚   â””â”€â”€ http/                     # HTTP API âœ… å·²å®ç°
â”‚       â”œâ”€â”€ handler/
â”‚       â”‚   â””â”€â”€ handler.go       # API å¤„ç†å™¨
â”‚       â””â”€â”€ middleware/          # ä¸­é—´ä»¶ ğŸš§ å¾…å®ç°
â”‚           â”œâ”€â”€ auth.go
â”‚           â””â”€â”€ ratelimit.go
â”‚
â”œâ”€â”€ config/                       # é…ç½®æ–‡ä»¶ âœ… å·²å®ç°
â”‚   â”œâ”€â”€ config.go                # é…ç½®ç»“æ„ä½“
â”‚   â””â”€â”€ config.yaml              # é»˜è®¤é…ç½®
â”‚
â”œâ”€â”€ docs/                         # æ–‡æ¡£ âœ… å·²å®ç°
â”‚   â”œâ”€â”€ ARCHITECTURE.md          # ç³»ç»Ÿæ¶æ„
â”‚   â””â”€â”€ STRUCTURE.md             # ç›®å½•ç»“æ„ï¼ˆæœ¬æ–‡ä»¶ï¼‰
â”‚
â”œâ”€â”€ migrations/                   # æ•°æ®åº“è¿ç§» ğŸš§ å¾…å®ç°
â”‚   â”œâ”€â”€ 001_init.sql
â”‚   â””â”€â”€ 002_add_risk_table.sql
â”‚
â”œâ”€â”€ scripts/                      # è„šæœ¬å·¥å…· ğŸš§ å¾…å®ç°
â”‚   â”œâ”€â”€ deploy.sh
â”‚   â””â”€â”€ backup.sh
â”‚
â”œâ”€â”€ test/                         # é›†æˆæµ‹è¯• ğŸš§ å¾…å®ç°
â”‚   â””â”€â”€ integration/
â”‚
â”œâ”€â”€ .gitignore                   # Git å¿½ç•¥é…ç½® âœ…
â”œâ”€â”€ go.mod                       # Go æ¨¡å—æ–‡ä»¶ âœ…
â”œâ”€â”€ go.sum                       # Go ä¾èµ–é”å®š
â”œâ”€â”€ Makefile                     # æ„å»ºè„šæœ¬ âœ…
â””â”€â”€ README.md                    # é¡¹ç›®è¯´æ˜ âœ…
```

## ğŸ“¦ ç›®å½•èŒè´£è¯´æ˜

### cmd/ - å¯æ‰§è¡Œç¨‹åº

æ¯ä¸ªå­ç›®å½•å¯¹åº”ä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºï¼š

- **server**: HTTP API æœåŠ¡ï¼Œå¯¹å¤–æä¾›é’±åŒ…æ¥å£
- **worker**: åå°ä»»åŠ¡ï¼Œè¿è¡Œæ‰«å—ã€å½’é›†ç­‰é•¿æœŸä»»åŠ¡
- **cli**: å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºæµ‹è¯•å’Œè°ƒè¯•

### internal/ - ç§æœ‰ä¸šåŠ¡é€»è¾‘

**ä¸ºä»€ä¹ˆå« internalï¼Ÿ**
Go çš„ `internal` ç›®å½•æœ‰ç‰¹æ®Šå«ä¹‰ï¼šåªèƒ½è¢«åŒä¸€æ¨¡å—å†…çš„ä»£ç å¯¼å…¥ï¼Œä¸èƒ½è¢«å¤–éƒ¨å¯¼å…¥ã€‚è¿™ä¿è¯äº†ä¸šåŠ¡é€»è¾‘çš„å°è£…æ€§ã€‚

æ ¸å¿ƒæ¨¡å—ï¼š
- **scanner**: æ‰«æåŒºå—é“¾ï¼Œæ£€æµ‹äº¤æ˜“
- **transfer**: å‘é€äº¤æ˜“åˆ°é“¾ä¸Š
- **collect**: è‡ªåŠ¨å½’é›†èµ„é‡‘
- **deposit**: å¤„ç†ç”¨æˆ·å……å€¼
- **risk**: é£é™©æ§åˆ¶å’Œå®¡æ‰¹
- **wallet**: é’±åŒ…å’Œå¯†é’¥ç®¡ç†
- **repository**: æ•°æ®åº“è®¿é—®å±‚
- **service**: ä¸šåŠ¡æœåŠ¡å±‚

### pkg/ - å…¬å…±åº“

**å¯å¤ç”¨çš„å·¥å…·åº“**ï¼Œå…¶ä»–é¡¹ç›®ä¹Ÿå¯ä»¥å¯¼å…¥ä½¿ç”¨ï¼š

- **gas**: Gas è´¹ç”¨ä¼°ç®—ï¼ˆå·²å®Œæˆï¼‰
- **chain**: å¤šé“¾å®¢æˆ·ç«¯å°è£…
- **signer**: äº¤æ˜“ç­¾å
- **crypto**: åŠ å¯†è§£å¯†
- **utils**: é€šç”¨å·¥å…·å‡½æ•°

### api/ - API å±‚

å¯¹å¤–æ¥å£å®šä¹‰ï¼š
- **http**: RESTful API
- **grpc**: gRPC APIï¼ˆå¯é€‰ï¼‰

### config/ - é…ç½®ç®¡ç†

- `config.go`: é…ç½®ç»“æ„ä½“å®šä¹‰
- `config.yaml`: é»˜è®¤é…ç½®æ–‡ä»¶
- æ”¯æŒç¯å¢ƒå˜é‡è¦†ç›–

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åˆå§‹åŒ–é¡¹ç›®

```bash
cd /home/andy/andy/wallet
go mod download
```

### 2. è¿è¡Œ CLI å·¥å…·ï¼ˆGas ä¼°ç®—ï¼‰

```bash
go run cmd/cli/main.go
```

### 3. å¯åŠ¨ API æœåŠ¡å™¨

```bash
go run cmd/server/main.go
```

è®¿é—®: http://localhost:8080/health

### 4. å¯åŠ¨åå° Workerï¼ˆæ‰«å—ï¼‰

```bash
# å…ˆé…ç½® config.yaml ä¸­çš„é“¾ RPC
go run cmd/worker/main.go
```

## ğŸ“ å¼€å‘è§„èŒƒ

### ä»£ç ç»„ç»‡

```
feature/
â”œâ”€â”€ handler.go      # æ ¸å¿ƒé€»è¾‘
â”œâ”€â”€ handler_test.go # å•å…ƒæµ‹è¯•
â”œâ”€â”€ types.go        # ç±»å‹å®šä¹‰
â””â”€â”€ utils.go        # è¾…åŠ©å‡½æ•°
```

### å‘½åè§„èŒƒ

- **æ–‡ä»¶å**: å°å†™ + ä¸‹åˆ’çº¿ï¼Œå¦‚ `deposit_handler.go`
- **åŒ…å**: å°å†™å•æ•°ï¼Œå¦‚ `package scanner`
- **æ¥å£å**: åè¯ï¼Œå¦‚ `Handler`, `Repository`
- **å‡½æ•°å**: åŠ¨è¯å¼€å¤´ï¼Œå¦‚ `HandleBlock()`, `GetBalance()`

### å¯¼å…¥è§„èŒƒ

```go
import (
    // æ ‡å‡†åº“
    "context"
    "fmt"

    // ç¬¬ä¸‰æ–¹åº“
    "github.com/ethereum/go-ethereum/common"

    // æœ¬é¡¹ç›®
    "wallet/pkg/gas"
    "wallet/internal/scanner"
)
```

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

```bash
# è¿è¡Œæµ‹è¯•
make test

# æ ¼å¼åŒ–ä»£ç 
make fmt

# ç¼–è¯‘æ‰€æœ‰ç¨‹åº
make build

# è¿è¡Œ Gas ä¼°ç®—ç¤ºä¾‹
make run-gas

# è¿è¡Œ API æœåŠ¡å™¨
make run-server

# è¿è¡Œ Worker
make run-worker
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ç³»ç»Ÿæ¶æ„](./ARCHITECTURE.md)
- [API æ–‡æ¡£](./API.md) (å¾…åˆ›å»º)
- [éƒ¨ç½²æŒ‡å—](./DEPLOY.md) (å¾…åˆ›å»º)

## âœ… å·²å®ç°åŠŸèƒ½

- [x] é¡¹ç›®ç»“æ„æ­å»º
- [x] Gas ä¼°ç®—æ¨¡å—
- [x] æ‰«å—æ¨¡å—
- [x] è½¬è´¦æ¨¡å—
- [x] é£æ§æ¨¡å—
- [x] é…ç½®ç®¡ç†
- [x] HTTP API æ¡†æ¶

## ğŸš§ å¾…å®ç°åŠŸèƒ½

- [ ] å½’é›†æ¨¡å—
- [ ] å…¥è´¦ç¡®è®¤
- [ ] é’±åŒ…ç®¡ç†
- [ ] æ•°æ®åº“é›†æˆ
- [ ] å®Œæ•´çš„ API å®ç°
- [ ] ä»£å¸æ”¯æŒï¼ˆERC20/BEP20ï¼‰
- [ ] ç›‘æ§å‘Šè­¦
- [ ] éƒ¨ç½²è„šæœ¬
